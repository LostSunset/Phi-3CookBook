# Azure AI Studio を使用した Phi-3 のファインチューニング

Microsoft の Phi-3 Mini 言語モデルを Azure AI Studio を使用してファインチューニングする方法を探ってみましょう。ファインチューニングにより、Phi-3 Mini を特定のタスクに適応させ、さらに強力でコンテキストに敏感なものにすることができます。

## 考慮事項

- **機能:** どのモデルがファインチューニング可能か？ベースモデルは何ができるようにファインチューニングできるか？
- **コスト:** ファインチューニングの料金モデルはどうなっているか？
- **カスタマイズ性:** ベースモデルをどの程度変更できるか？どのように変更できるか？
- **利便性:** ファインチューニングは実際にどのように行われるか？カスタムコードを書く必要があるか？自分で計算リソースを用意する必要があるか？
- **安全性:** ファインチューニングされたモデルには安全性のリスクがあることが知られているが、意図しない害を防ぐためのガードレールはあるか？

![AIStudio Models](../../../../imgs/05/AIStudio/AIStudioModels.png)

以下は、始めるための具体的な手順です。

## Azure AI Studio を使用した Phi-3 のファインチューニング

![Finetune AI Studio](../../../../imgs/05/AIStudio/AIStudiofinetune.png)

**環境の設定**

Azure AI Studio: まだお持ちでない場合は、[Azure AI Studio](https://ai.azure.com?WT.mc_id=aiml-138114-kinfeylo) にサインインしてください。

**新しいプロジェクトの作成**

「New」をクリックして新しいプロジェクトを作成し、使用目的に応じて適切な設定を選択します。

![FineTuneSelect](../../../../imgs/05/AIStudio/AIStudiofinetuneselect.png)

### データ準備

**データセットの選択**

タスクに関連するデータセットを収集または作成します。これには、チャット指示、質問と回答のペア、またはその他の関連するテキストデータが含まれます。

データセットの選択

![FineTuneSelect](../../../../imgs/05/AIStudio/AIStudiofintunetask.png)

データセットの選択

![FinetuneDataSelect](../../../../imgs/05/AIStudio/AIStudiodatafintuneselect.png)

データセットのプレビュー

![Finetuneselect](../../../../imgs/05/AIStudio/AIStudiofinetunepreview.png)

**高度な使用法**

![FineTuneAdvanced](../../../../imgs/05/AIStudio/AIStudiofinetuneadvanced.png)

**データの前処理**

データをクリーンアップし、前処理を行います。ノイズを除去し、欠損値を処理し、テキストをトークン化します。

## モデルの選択

**Phi-3 Mini**

事前にトレーニングされた Phi-3 Mini モデルをファインチューニングします。モデルのチェックポイント（例: "microsoft/Phi-3-mini-4k-instruct"）にアクセスできることを確認してください。

**ファインチューニングの設定**

ハイパーパラメータ: 学習率、バッチサイズ、トレーニングエポック数などのハイパーパラメータを定義します。

**損失関数**

タスクに適した損失関数を選択します（例: クロスエントロピー）。

**オプティマイザ**

トレーニング中の勾配更新に使用するオプティマイザを選択します（例: Adam）。

**ファインチューニングプロセス**

- 事前トレーニングされたモデルの読み込み: Phi-3 Mini チェックポイントを読み込みます。
- カスタムレイヤーの追加: タスク固有のレイヤーを追加します（例: チャット指示用の分類ヘッド）。

**モデルのトレーニング**
準備したデータセットを使用してモデルをファインチューニングします。トレーニングの進行状況を監視し、必要に応じてハイパーパラメータを調整します。

**評価と検証**

検証セット: データをトレーニングセットと検証セットに分割します。

**パフォーマンスの評価**

精度、F1スコア、パープレキシティなどの指標を使用してモデルのパフォーマンスを評価します。

## ファインチューニングされたモデルの保存

**チェックポイント**
将来の使用のためにファインチューニングされたモデルのチェックポイントを保存します。

## デプロイ

- Web サービスとしてデプロイ: ファインチューニングされたモデルを Azure AI Studio で Web サービスとしてデプロイします。
- エンドポイントのテスト: デプロイされたエンドポイントにテストクエリを送信して、その機能を検証します。

## 繰り返しと改善

繰り返し: パフォーマンスが満足できない場合は、ハイパーパラメータを調整したり、データを追加したり、追加のエポックでファインチューニングを行ったりして繰り返し改善します。

## 監視と最適化

モデルの動作を継続的に監視し、必要に応じて最適化します。

## カスタマイズと拡張

カスタムタスク: Phi-3 Mini はチャット指示以外のさまざまなタスクに対してファインチューニングできます。他のユースケースを探求してください！
実験: パフォーマンスを向上させるために、さまざまなアーキテクチャ、レイヤーの組み合わせ、技術を試してみてください。

***注意***: ファインチューニングは反復的なプロセスです。実験、学習、モデルの調整を行い、特定のタスクに最適な結果を達成してください！
