# Phi-3-Vision-128K-Instruct プロジェクト概要

## モデル

Phi-3-Vision-128K-Instructは、このプロジェクトの中心にある軽量で最先端のマルチモーダルモデルです。これはPhi-3モデルファミリーの一部であり、最大128,000トークンのコンテキスト長をサポートしています。このモデルは、合成データや慎重にフィルタリングされた公開ウェブサイトを含む多様なデータセットでトレーニングされており、高品質で推論が必要なコンテンツを重視しています。トレーニングプロセスには、指示に正確に従うための監督ファインチューニングと直接の優先順位最適化が含まれており、強力な安全対策も備えています。

## サンプルデータの作成が重要な理由:

1. **テスト**: サンプルデータは、実際のデータに影響を与えずに、さまざまなシナリオでアプリケーションをテストすることを可能にします。これは特に開発およびステージングフェーズで重要です。

2. **パフォーマンスチューニング**: 実際のデータの規模と複雑さを模倣したサンプルデータを使用することで、パフォーマンスのボトルネックを特定し、アプリケーションを最適化できます。

3. **プロトタイピング**: サンプルデータは、ユーザーの要件を理解し、フィードバックを得るためのプロトタイプやモックアップを作成するために使用できます。

4. **データ分析**: データサイエンスでは、サンプルデータは探索的データ分析、モデルトレーニング、およびアルゴリズムテストに頻繁に使用されます。

5. **セキュリティ**: 開発およびテスト環境でサンプルデータを使用することで、実際のデータの意図しない漏洩を防ぐことができます。

6. **学習**: 新しい技術やツールを学ぶ場合、サンプルデータを使用することで、学んだことを実践するための実用的な方法を提供します。

サンプルデータの品質は、これらの活動に大きな影響を与える可能性があることを忘れないでください。構造と変動性の点で、実際のデータにできるだけ近いものであるべきです。

### サンプルデータの作成
[データセット生成スクリプト](./CreatingSampleData.md)

## データセット

良いサンプルデータセットの例は、[DBQ/Burberry.Product.prices.United.States データセット](https://huggingface.co/datasets/DBQ/Burberry.Product.prices.United.States)（Huggingfaceで利用可能）です。
Burberry製品のサンプルデータセットには、製品のカテゴリ、価格、タイトルに関するメタデータが含まれており、合計3,040行があり、それぞれがユニークな製品を表しています。このデータセットを使用して、モデルが視覚データを理解し解釈する能力をテストし、複雑な視覚的詳細やブランド固有の特徴を捉える記述的なテキストを生成します。

**注意:** 画像を含む任意のデータセットを使用できます。

## 複雑な推論

モデルは、画像のみを基に価格や命名について推論する必要があります。これには、モデルが視覚的特徴を認識するだけでなく、それらが製品の価値やブランドに与える影響を理解する必要があります。画像から正確なテキスト記述を生成することで、このプロジェクトは、視覚データを統合してモデルのパフォーマンスと多用途性を現実のアプリケーションで向上させる可能性を強調しています。

## Phi-3 Vision アーキテクチャ

モデルアーキテクチャは、Phi-3のマルチモーダルバージョンです。これは、テキストと画像データの両方を処理し、これらの入力を統一されたシーケンスに統合して、包括的な理解と生成タスクを実行します。モデルは、テキストと画像の埋め込み層を別々に使用します。テキストトークンは密なベクトルに変換され、画像はCLIPビジョンモデルを通じて処理され、特徴埋め込みが抽出されます。これらの画像埋め込みは、テキスト埋め込みの次元に一致するように投影され、シームレスに統合できるようにします。

## テキストと画像の埋め込みの統合

テキストシーケンス内の特殊なトークンは、画像埋め込みを挿入する場所を示します。処理中に、これらの特殊なトークンは対応する画像埋め込みに置き換えられ、モデルがテキストと画像を単一のシーケンスとして処理できるようにします。データセットのプロンプトは、次のように特殊な たとえば、次のようにフォーマットされます:

```python
text = f"<|user|>\n<|image_1|>この画像には何が表示されていますか？<|end|><|assistant|>\n製品: {row['title']}, カテゴリ: {row['category3_code']}, 定価: {row['full_price']}<|end|>"
```

## サンプルコード
- [Phi-3-Vision トレーニングスクリプト](../../../../code/04.Finetuning/Phi-3-vision-Trainingscript.py)
- [Weights and Bias の例のウォークスルー](https://wandb.ai/byyoung3/mlnews3/reports/How-to-fine-tune-Phi-3-vision-on-a-custom-dataset--Vmlldzo4MTEzMTg3)
